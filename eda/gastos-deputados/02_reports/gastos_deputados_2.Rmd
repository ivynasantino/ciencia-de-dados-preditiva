---
title: "Análise de gastos de parlamentares - parte 2"
author: "Ivyna Santino"
date: "07 de setembro de 2018"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, warning=FALSE, message=FALSE, include=FALSE}
library(tidyverse)
library(lubridate)
library(plotly)
theme_set(theme_minimal())
```

Explicar que é uma continuação de outro lab

Importando dados:
```{r, message=FALSE, warning=FALSE}
dadosCEAP = read_csv(("../data/dadosCEAP.csv"))
```

Breve descrição dos dados

Separando os estados brasileiros em suas respectivas regiões

```{r, message=FALSE, warning=FALSE}
dadosCEAP <- dadosCEAP %>% 
  mutate(
    regiao = case_when(
      sgUF %in% c("RJ", "SP", "ES", "MG") ~ "Sudeste",
      sgUF %in% c("PB", "RN", "SE", "BA", "MA", "PE", "AL", "CE", "PI") ~ "Nordeste",
      sgUF %in% c("GO", "MT", "MS", "DF") ~ "Centro-Oeste",
      sgUF %in% c("RS", "PR", "SC") ~ "Sul",
      sgUF %in% c("PA", "AC", "AM", "RO", "RR", "AP", "TO") ~ "Norte"
    )
  )
  
```


```{r, message=FALSE, warning=FALSE}
dadosCEAP <- dadosCEAP %>% 
  mutate(
    dia = day(dataEmissao),
    mes = month(dataEmissao),
    ano = year(dataEmissao))

dadosCEAP <- dadosCEAP %>% 
  mutate(data = paste(ano, mes, dia, sep='-') %>% 
           as.Date(.))

dadosCEAP$diaSemana <- weekdays(as.Date(dadosCEAP$data))

dadosCEAP <- dadosCEAP %>%
  mutate(fds = ifelse(diaSemana %in% c("sábado","domingo"),TRUE,FALSE))

```

Depois da separação dos estados em regiões(Norte, Nordeste, Sul, Sudeste e Centro Oeste) e da extração das datas do horário de emissão, vamos as perguntas:

### Com relação aos gastos de cada região, podemos observar se há alguma similaridade ou padrão com tipos de despesas e esses gastos?


```{r, warning=FALSE, message=FALSE}
dadosCEAP %>% 
  group_by(tipoDespesa,
           regiao) %>% 
  summarise(valorTot = sum(valorLíquido)) %>% 
  ggplot(aes(y = valorTot,
             x = regiao,
             fill = tipoDespesa)) +
  geom_col(position = position_identity()) 
  
```

### Com os dados da CEAP podemos ver a data de emissão do respectivo documento. Dessa forma, quanto e como gastam os partidos em finais de semana?

```{r, warning=FALSE, message=FALSE}
dadosCEAP %>%
  filter(fds == TRUE) %>% 
  group_by(tipoDespesa,
           sgPartido) %>% 
  summarise(valorTot = sum(valorLíquido)) %>% 
  arrange(-valorTot) %>%
  plot_ly(x = ~valorTot,
          y = ~tipoDespesa,
          color = ~sgPartido,
          type = 'scatter')
```
