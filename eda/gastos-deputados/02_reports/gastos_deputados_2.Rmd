---
title: "Análise de gastos de parlamentares - parte 2"
author: "Ivyna Santino"
date: "07 de setembro de 2018"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---

```{r setup, warning=FALSE, message=FALSE, include=FALSE}
library(tidyverse)
library(lubridate)
library(plotly)
theme_set(theme_minimal())
```

A princípio esse markdown é uma continuação desse aqui: [Análise de gastos dos parlamentares](), que demostra algumas análises descritivas dos dados da CEAP. Dessa forma, o objetivo da parte 2 é trazer novos questionamentos desses dados e analisá-los descritivamente.

Importando os dados:
```{r, message=FALSE, warning=FALSE}
dadosCEAP = read_csv(("../data/dadosCEAP.csv"))
```

Antes de começar com perguntas, iremos preparar os dados para o que iremos precisar:

1. Separar os estados brasileiros em suas respectivas regiões

```{r, message=FALSE, warning=FALSE}
dadosCEAP <- dadosCEAP %>% 
  mutate(
    regiao = case_when(
      sgUF %in% c("RJ", "SP", "ES", "MG") ~ "Sudeste",
      sgUF %in% c("PB", "RN", "SE", "BA", "MA", "PE", "AL", "CE", "PI") ~ "Nordeste",
      sgUF %in% c("GO", "MT", "MS", "DF") ~ "Centro-Oeste",
      sgUF %in% c("RS", "PR", "SC") ~ "Sul",
      sgUF %in% c("PA", "AC", "AM", "RO", "RR", "AP", "TO") ~ "Norte"
    )
  )
  
```

2. Extrair só a data do parâmentro data de emissão e verificar os finais de semana:

```{r, message=FALSE, warning=FALSE}
dadosCEAP <- dadosCEAP %>% 
  mutate(
    dia = day(dataEmissao),
    mes = month(dataEmissao),
    ano = year(dataEmissao))

dadosCEAP <- dadosCEAP %>% 
  mutate(data = paste(ano, mes, dia, sep='-') %>% 
           as.Date(.))

dadosCEAP$diaSemana <- weekdays(as.Date(dadosCEAP$data))

dadosCEAP <- dadosCEAP %>%
  mutate(fds = ifelse(diaSemana %in% c("sábado","domingo"),TRUE,FALSE))

```

Depois da separação dos estados em regiões(Norte, Nordeste, Sul, Sudeste e Centro Oeste) e da extração das datas do horário de emissão, vamos as perguntas:

### Com relação aos gastos de cada região, podemos observar se há alguma similaridade ou padrão com tipos de despesas e esses gastos?

```{r, warning=FALSE, message=FALSE}
dadosCEAP %>% 
  group_by(tipoDespesa,
           regiao) %>% 
  summarise(valorTot = sum(valorLíquido)) %>% 
  ggplot(aes(y = valorTot,
             x = regiao,
             fill = tipoDespesa)) +
  geom_col(position = position_identity()) 
  
```

Como podemos observar no gráfico acima, os tipos de despesas que mais se fazem presente nos finais de semana são:

- Fornecimento de alimentação do parlamentar;
- Divulgação de atividade do parlamentar;
- Manutenção de escritório de apoio à atividade parlamentar;
- Telefonia.

Ao elencar os tópicos acima, podemos ver que regiões como Sul e Sudeste tiveram comportamentos semelhantes com os tipos de despesa, ao gastar com fornecimento de alimentação, manutenção de escritório e telefonia. Já as demais regiões, Norte, Nordeste e Centro Oeste tiveram como top 3 com divulgação de atividade parlamentar, fornecimento de alimentação e serviços de telefonia.

É válido ressaltar, assim como foi feito no markdown parte 1, que a proporção de parlamentares de cada região do Brasil é diferente, por exemplo, a região Sudeste tem a maior concentração de parlamentares e com isso, consequentemente, os gastos naturalmente tendem a serem maiores.

### Com os dados da CEAP podemos ver a data de emissão do respectivo documento. Dessa forma, quanto e como gastam os partidos em finais de semana?

```{r, warning=FALSE, message=FALSE}
dadosCEAP %>%
  filter(fds == TRUE) %>% 
  group_by(tipoDespesa,
           sgPartido) %>% 
  summarise(valorTot = sum(valorLíquido)) %>% 
  arrange(-valorTot) %>%
  plot_ly(x = ~valorTot,
          y = ~tipoDespesa,
          color = ~sgPartido,
          type = 'scatter')
```
