---
title: "Usando regressão linear para explicar a votação de deputados"
author: "Ivyna Santino"
date: "26 de setembro de 2018"
output: html_document
---

```{r setup, include=FALSE, message=FALSE}
library(tidyverse)
library(here)
library(dplyr)
library(corrplot)
library(RColorBrewer)
options(max.print = .Machine$integer.max)
theme_set(theme_minimal())
```

```{r, message=FALSE, warning=FALSE}
importa_eleicao <- function(dataset_path) {
  read = read_csv(here(paste("data", dataset_path, sep = "/")))
  return(read)
}

eleicao_2006 <- importa_eleicao("eleicoes_2006.csv")
eleicao_2010 <- importa_eleicao("eleicoes_2010.csv")
eleicao_2006_2010 <- importa_eleicao("eleicoes_2006_e_2010.csv")
```

```{r}
names(eleicao_2006)
```

```{r, message=FALSE, warning=FALSE}
select_2006 %>% 
  gather(key = "variavel",
         value = "valor") %>% 
  ggplot(aes(x = valor)) +
  geom_histogram(bins = 30) +
  facet_wrap(~variavel, scales = "free_x") +
  labs(title = "Linear")

select_2006 %>% 
  gather(key = "variavel",
         value = "valor") %>% 
  ggplot(aes(x = log(valor))) +
  geom_histogram(bins = 30) +
  facet_wrap(~variavel, scales = "free_x") +
  labs(title = "Log")

```



```{r, message=FALSE, warning=FALSE}
eleicao_2010$uf <- as.numeric(eleicao_2010$uf)
eleicao_2010$partido <- as.numeric(eleicao_2010$partido)
eleicao_2010$sexo <- as.numeric(eleicao_2010$sexo)
eleicao_2010$grau <- as.numeric(eleicao_2010$grau)
eleicao_2010$estado_civil <- as.numeric(eleicao_2010$estado_civil)
eleicao_2010$ocupacao <- as.numeric(eleicao_2010$ocupacao)
  
```

```{r}
names(eleicao_2006)
```



```{r, message=FALSE, warning=FALSE}
#eleicao_2006$quantidade_doacoes = log(eleicao_2006$quantidade_doacoes)
#eleicao_2006$quantidade_doadores = log(eleicao_2006$quantidade_doadores)
#eleicao_2006$total_receita = log(eleicao_2006$total_receita)
#eleicao_2006$media_receita = log(eleicao_2006$media_receita)
#eleicao_2006$recursos_de_pessoas_fisicas = log(eleicao_2006$recursos_de_pessoas_fisicas)
#eleicao_2006$recursos_de_pessoas_juridicas = log(eleicao_2006$recursos_de_pessoas_juridicas)
#eleicao_2006$total_despesa = log(eleicao_2006$total_despesa)
#eleicao_2006$media_despesa = log(eleicao_2006$media_despesa)
#eleicao_2006$votos = log(eleicao_2006$votos)


eleicao_2006$uf <- as.factor(eleicao_2006$uf)
eleicao_2006$partido <- as.factor(eleicao_2006$partido)
eleicao_2006$sexo <- as.factor(eleicao_2006$sexo)
eleicao_2006$grau <- as.factor(eleicao_2006$grau)
eleicao_2006$estado_civil <- as.factor(eleicao_2006$estado_civil)
eleicao_2006$ocupacao <- as.factor(eleicao_2006$ocupacao)
  
```


```{r, message=FALSE, warning=FALSE}
seleciona_variaveis <- function(dataframe) {
  return(dataframe %>% 
    select(qtd_doacoes = quantidade_doacoes,
         qtd_doadores = quantidade_doadores,
         tot_receita = total_receita,
         med_receita = media_receita,
         outros_cand = recursos_de_outros_candidatos.comites,
         pes_fisica = recursos_de_pessoas_fisicas,
         pes_juridica = recursos_de_pessoas_juridicas,
         rec_prop = recursos_proprios,
         rec_partido = recursos_de_partido_politico,
         qtd_desp = quantidade_despesas,
         qtd_fornec = quantidade_fornecedores,
         tot_desp = total_despesa,
         med_desp = media_despesa,
         votos))
}

select_2006 <- seleciona_variaveis(eleicao_2006)
select_2010 <- seleciona_variaveis(eleicao_2010)
select_2006_2010 <- seleciona_variaveis(eleicao_2006_2010)

```


### 1. Um modelo de regressão múltipla com todas as variáveis é plausível para explicar a variação em y (número de votos) em 2006? Mesma pergunta para 2010.
fazer uma regressao multipla com todas as variaveis e ver se é legal

```{r, message=FALSE, warning=FALSE}
eleicao_2006_mod <- eleicao_2006 %>% 
  select(-cargo,
         -nome,
         -sequencial_candidato,
         -ano)
```


```{r, message=FALSE, warning=FALSE}
modelo_tot_06 <- lm(votos ~ ., 
                    data = eleicao_2006_mod, 
                    na.action = na.omit)
```

```{r, message=FALSE, warning=FALSE}
summary(modelo_tot_06)
```

```{r, message=FALSE, warning=FALSE}
print(mean(modelo_tot_06$residuals))
```


```{r, message=FALSE, warning=FALSE}
modelo_tot_06 %>% 
  ggplot(aes(.fitted, .resid)) +
  geom_jitter(alpha = .5) +
  geom_hline(yintercept = 0,
             color = "darkorange",
             linetype = "dashed")


qqnorm(modelo_tot_06$residuals)
qqline(modelo_tot_06$residuals,
       col = 2,
       lwd = 2,
       lty = 2)
```


```{r}
eleicao_2010_mod <- eleicao_2010 %>% 
  select(-cargo,
         -nome,
         -sequencial_candidato,
         -ano)
```

```{r, message=FALSE, warning=FALSE}
modelo_tot_10 <- lm(votos ~ ., 
                    data = eleicao_2010_mod,
                    na.action = na.omit)
```

```{r, message=FALSE, warning=FALSE}
summary(modelo_tot_10)
```

```{r, message=FALSE, warning=FALSE}
print(mean(modelo_tot_10$residuals))
```


```{r, message=FALSE, warning=FALSE}
modelo_tot_10 %>% 
  ggplot(aes(.fitted, .resid)) +
  geom_jitter(alpha = .5) +
  geom_hline(yintercept = 0,
             color = "darkorange",
             linetype = "dashed")

qqnorm(modelo_tot_10$residuals)
qqline(modelo_tot_10$residuals,
       col = 2,
       lwd = 2,
       lty = 2)

```

### 2.Compare as regressões construídas para 2006 e 2010. Quais as diferenças/semelhanças percebidas? Algumas sugestões:
  Analise os plots de resíduos e verifique se há tendências nos erros para cada ano.
  Quais variáveis conseguem explicar melhor o número de votos? Compare essas variáveis entre os modelos. Mesma coisa para as variáveis menos explicativas.
  Compare os valores de R2 e RSE considerando as regressões para cada ano.
  Inclua outros pontos de comparação que você ache interessante.

Explicar modelo da questão 1

### 3.Todas as variáveis são úteis para os modelos de regressão? Há variáveis redudantes? Faça análises para 2006 e 2010 separadamente. 

```{r, message=FALSE, warning=FALSE}
# 2006
correlacao_06 <- select_2006 %>% 
  cor()

corrplot(correlacao_06, type = "upper",
         order = "hclust",
         number.cex = .6,
         addCoef.col = "#FF7F50",
         tl.col = "black", tl.srt = 90,
         col = brewer.pal(n = 8, name = "PuOr"))

```
Variáveis úteis para voto

correlacao forte com relacao a votos: tot_desp = 0.66, e
                                      -pes_juridica = 0.59, 
                                      tot_receita = 0.64, e
                                      med_receita = 0.48, e
                                      -qnt_fornec = 0.43, 
                                      -qnt_desp = 0.42, 
                                      pes_fisica = 0.44, 
                                      qtd_doacoes = 0.47, 
                                      qnt_doadores = 0.47


```{r, message=FALSE, warning=FALSE}
# 2010
correlacao_10 <- select_2010 %>% 
  cor()

corrplot(correlacao_10, type = "upper",
         order = "hclust",
         number.cex = .6,
         addCoef.col = "#B22222",
         tl.col = "black", tl.srt = 90,
         col = brewer.pal(n = 8, name = "RdYlBu"))
```
correlacao forte com relacao a voto: pes_juridica = 0.54, tot_receita = 0.63, tot_desp = 0.64

escolher = tot_desp, tot_desp

### 4.No caso de haver variáveis pouco explicativas e/ou redudantes, construa um novo modelo sem essas variáveis e o compare ao modelo com todas as variáveis (e.g. em termos de R2 e RSE). Faça isso para 2006 e 2010 separadamente. 

```{r, message=FALSE, warning=FALSE}
a <- eleicao_2006 %>% 
  select(votos,
         total_despesa,
         total_receita,
         media_receita,
         recursos_de_pessoas_fisicas,
         recursos_de_pessoas_juridicas)
```


```{r, message=FALSE, warning=FALSE}
modelo_06 <- lm(votos ~ .,
                data = a,
                na.action = na.omit)
```

```{r}
print(mean(modelo_06$residuals))
```


```{r, message=FALSE, warning=FALSE}
summary(modelo_06)
```


```{r, message=FALSE, warning=FALSE}
b <- select_2010 %>% 
  select(votos,
         tot_desp,
         tot_receita)
```


```{r, message=FALSE, warning=FALSE}
modelo_10 <- lm(votos ~ .,
                data = b,
                na.action = na.omit)
```

```{r}
print(mean(modelo_10$residuals))
```


```{r, message=FALSE, warning=FALSE}
summary(modelo_10)
```

```{r, message=FALSE, warning=FALSE}
modelo_06 %>% 
  ggplot(aes(.fitted, .resid)) +
  geom_jitter(alpha = .5) +
  geom_hline(yintercept = 0,
             color = "darkorange",
             linetype = "dashed")


qqnorm(modelo_06$residuals)
qqline(modelo_06$residuals,
       col = 2,
       lwd = 2,
       lty = 2)
```


### 5.Construa agora uma regressão considerando os anos 2006 e 2010 em conjunto. Que diferenças/semelhanças você percebe em relação aos modelos individuais por ano? Veja a questão 2 para sugestões que você usar para comparação.


```{r, message=FALSE, warning=FALSE}
eleicao_06_10_mod <- eleicao_2006_2010 %>% 
  select(-cargo,
         -nome,
         -sequencial_candidato,
         -ano)
```


```{r, message=FALSE, warning=FALSE}
modelo_tot_06_10 <- lm(votos ~ ., 
                    data = eleicao_06_10_mod, 
                    na.action = na.omit)
```

```{r, message=FALSE, warning=FALSE}
summary(modelo_tot_06)
```

```{r, message=FALSE, warning=FALSE}

correlacao_06_10 <- select_2006_2010 %>% 
  cor()

corrplot(correlacao_06_10, type = "upper",
         order = "hclust",
         number.cex = .6,
         addCoef.col = "#FF7F50",
         tl.col = "black", tl.srt = 90,
         col = brewer.pal(n = 8, name = "PuOr"))

```

votos = tot_desp + qnt_doacoes

```{r, message=FALSE, warning=FALSE}
c <- eleicao_2006_2010 %>% 
  select(votos,
         total_despesa,
         total_receita,
         recursos_de_outros_candidatos.comites,
         recursos_de_pessoas_fisicas,
         recursos_de_pessoas_juridicas,
         quantidade_doacoes,
         )
```


```{r, message=FALSE, warning=FALSE}
modelo_tot_06_10 <- lm(votos ~ ., 
                    data = c, 
                    na.action = na.omit)
```

```{r}
print(mean(modelo_tot_06_10$residuals))
```


```{r, message=FALSE, warning=FALSE}
summary(modelo_tot_06_10)
```

```{r, message=FALSE, warning=FALSE}
modelo_tot_06_10 %>% 
  ggplot(aes(.fitted, .resid)) +
  geom_jitter(alpha = .5) +
  geom_hline(yintercept = 0,
             color = "darkorange",
             linetype = "dashed")


qqnorm(modelo_tot_06_10$residuals)
qqline(modelo_tot_06_10$residuals,
       col = 2,
       lwd = 2,
       lty = 2)
```




